commit a3500e14ca4af38034d5ad2115ca7ac271c8c5b4
Author: Miroslav Lichvar <mlichvar@redhat.com>
Date:   Mon Feb 6 15:43:00 2017 +0100

    Fix leaks of sockets on errors.
    
    Signed-off-by: Miroslav Lichvar <mlichvar@redhat.com>

diff --git a/clock.c b/clock.c
index a6a1a1a..9481606 100644
--- a/clock.c
+++ b/clock.c
@@ -824,11 +824,13 @@ static int clock_add_port(struct clock *c, int phc_index,
 	}
 	index = sk_interface_index(fd, iface->name);
 	if (index < 0) {
+		close(fd);
 		return -1;
 	}
 	snprintf(key, sizeof(key), "%d", index);
 	if (hash_insert(c->index2port, key, p)) {
 		pr_err("failed to add port with index %d twice!", index);
+		close(fd);
 		return -1;
 	}
 	close(fd);
diff --git a/rtnl.c b/rtnl.c
index 7f5dc45..251b5f3 100644
--- a/rtnl.c
+++ b/rtnl.c
@@ -160,6 +160,7 @@ int rtnl_open(void)
 	}
 	if (bind(fd, (struct sockaddr *) &sa, sizeof(sa))) {
 		pr_err("failed to bind netlink socket: %m");
+		close(fd);
 		return -1;
 	}
 	return fd;
